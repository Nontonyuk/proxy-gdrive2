<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Player Generator</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    input, select, textarea { width: 100%; padding: 8px; margin: 6px 0; }
    label { font-weight: bold; margin-top: 10px; display: block; }
    button { padding: 10px 20px; background: #2196F3; color: white; border: none; cursor: pointer; }
    iframe { width: 100%; height: 300px; border: 1px solid #ccc; margin-top: 10px; }
    .output { background: #eee; padding: 10px; word-break: break-all; }
  </style>
</head>
<body>
  <h2>üîß Player Generator</h2>
  <form id="playerForm">
    <label>Google Drive File ID / YouTube URL</label>
    <input type="text" id="src" required>

    <label>API Key (for Google Drive only)</label>
    <input type="text" id="AIzaSyBaDYhcPunj8GppsaCiJIAklevVIe3o_fA">

    <label>JWPlayer Library ID (only for JWPlayer)</label>
    <input type="text" id="jwplayerId">

    <label>Pilih Player</label>
    <select id="type">
      <option value="plyr">Plyr.io</option>
      <option value="jwplayer">JWPlayer</option>
      <option value="fluid">Fluid Player</option>
      <option value="default">Default HTML5 Video</option>
    </select>

    <label>Token Expiry (menit)</label>
    <input type="number" id="expiry" value="120">

    <button type="submit">Generate Token + Iframe</button>
  </form>

  <h3>üîê Embed Code:</h3>
  <textarea id="embedCode" class="output" rows="3" readonly></textarea>

  <h3>‚ñ∂Ô∏è Preview:</h3>
  <iframe id="previewFrame" src=""></iframe>

  <script>
    const SECRET = '%Ir;vPL+VJ:D#xA[e#j1&.@^LkW*#S(z'; // sama dengan di Worker

    async function generateToken(data) {
      const encoder = new TextEncoder();
      const raw = btoa(JSON.stringify(data));
      const key = await crypto.subtle.importKey(
        'raw', encoder.encode(SECRET), { name: 'HMAC', hash: 'SHA-256' }, false, ['sign']
      );
      const sigBuf = await crypto.subtle.sign('HMAC', key, encoder.encode(raw));
      const sig = btoa(String.fromCharCode(...new Uint8Array(sigBuf)))
        .replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
      return `${raw}.${sig}`;
    }

    document.getElementById('playerForm').addEventListener('submit', async e => {
      e.preventDefault();

      const src = document.getElementById('src').value.trim();
      const apikey = document.getElementById('apikey').value.trim();
      const jwplayerId = document.getElementById('jwplayerId').value.trim();
      const type = document.getElementById('type').value;
      const expMin = parseInt(document.getElementById('expiry').value);

      const exp = Math.floor(Date.now() / 1000) + (expMin * 60);
      const payload = { src, apikey, type, jwplayerId, exp };
      const token = await generateToken(payload);

      const url = `https://player.kinikita-xyz.workers.dev/video/${token}`;
      document.getElementById('embedCode').value = `<iframe src=\"${url}\" width=\"100%\" height=\"480\" allowfullscreen frameborder=\"0\"></iframe>`;
      document.getElementById('previewFrame').src = url;
    });
  </script>
</body>
</html>
